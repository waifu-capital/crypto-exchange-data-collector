# Crypto Exchange Data Collector Configuration
# Direct Parquet Streaming Architecture (no SQLite intermediate storage)
#
# AWS credentials must be set via environment variables:
#   AWS_ACCESS_KEY - AWS access key ID
#   AWS_SECRET_KEY - AWS secret access key

[collector]
# Prometheus metrics HTTP port
metrics_port = 9090
# How many days to keep log files
log_retention_days = 1

[aws]
region = "us-west-2"
bucket = "crypto-exchange-data-collector"
# Optional: identifier for this server (appears in S3 path)
home_server_name = "cherry-wondrous-mongrel"

[storage]
# Storage mode: "s3" (default), "local", or "both"
# - s3: Upload to S3, delete local files after successful upload
# - local: Keep files locally only (no S3, AWS credentials not required)
# - both: Upload to S3 AND keep a local copy
mode = "s3"
# Directory for Parquet files (streaming writes)
# Structure: {data_dir}/{exchange}/{symbol}/{data_type}/{server}/{date}/{timestamp}.parquet
data_dir = "data/parquet"
# Directory for permanent local storage (only used when mode is "local" or "both")
local_path = "data/archive"

[websocket]
# Timeout before considering a connection stale and reconnecting (seconds)
message_timeout_secs = 180
# Initial delay before retrying a failed connection (seconds)
initial_retry_delay_secs = 5
# Maximum delay between retry attempts with exponential backoff (seconds)
max_retry_delay_secs = 60

# Market pairs to collect data from
# Each [[markets]] section specifies an exchange and its symbols

[[markets]]
exchange = "binance"
symbols = ["btcusdt", "ethusdt", "solusdt", "xrpusdt"]
# feeds defaults to ["orderbook", "trades"] if not specified
#
# Binance WebSocket endpoint (optional)
# Default: wss://stream.binance.com:9443/ws
#
# IMPORTANT: If running from a US-based server (AWS EC2 us-east-1, etc.),
# you will get "451 Unavailable For Legal Reasons" because Binance geo-blocks
# US IP addresses from stream.binance.com.
#
# Alternative endpoints:
#
# 1. data-stream.binance.vision (RECOMMENDED for US servers)
#    Market data endpoint that may bypass geo-restrictions.
#    Same trading pairs as international Binance.
#    base_url = "wss://data-stream.binance.vision/ws"
#
# 2. stream.binance.us (Binance.US)
#    US-regulated exchange. NOTE: Different trading pairs!
#    Uses USD pairs (e.g., BTCUSD) not USDT pairs (BTCUSDT).
#    base_url = "wss://stream.binance.us:9443/ws"
#
# base_url = "wss://stream.binance.com:9443/ws"

[[markets]]
exchange = "coinbase"
symbols = ["BTC-USD", "ETH-USD", "SOL-USD", "XRP-USD"]
# Coinbase level2 (orderbook) requires authentication since Aug 2023
# Set COINBASE_API_KEY and COINBASE_API_SECRET env vars for orderbook access
# Without credentials, only trades will be collected (orderbook subscription skipped)
feeds = ["orderbook", "trades"]

[[markets]]
exchange = "bybit"
symbols = ["BTCUSDT", "ETHUSDT", "SOLUSDT", "XRPUSDT"]
feeds = ["orderbook", "trades"]
# Bybit markets can have lower activity during off-peak hours
# Default uses global websocket.message_timeout_secs (180s, reconnect after 9 min).
# With 200s, reconnect happens after 10 minutes of no data.
data_timeout_secs = 200

[[markets]]
exchange = "okx"
symbols = ["BTC-USDT", "ETH-USDT", "SOL-USDT", "XRP-USDT"]
feeds = ["orderbook", "trades"]
# OKX markets can have lower activity during off-peak hours
# Default uses global websocket.message_timeout_secs (180s, reconnect after 9 min).
# With 200s, reconnect happens after 10 minutes of no data.
data_timeout_secs = 200

# this doesn't work
# you can only use it if you are in a specific region? https://global-docs.upbit.com/reference/websocket-orderbook
# [[markets]]
# exchange = "upbit"
# symbols = ["SGD-BTC", "SGD-ETH"]
# feeds = ["orderbook", "trades"]
